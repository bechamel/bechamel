<link rel="import" type="html" href="../../../../vendor/polymer/polymer.html">

<dom-module id="br-selectbox">

  <link rel="import" type="css" href="../dist/br-selectbox.css">

  <template>
    <div class="drop drop__down">
      <button class="drop-button" on-click='_toggleSelect'>
        <span class="drop-button-label">Selecione</span>
        <i class="drop-button-icon fa fa-caret-down"></i>
      </button>
      <div class="drop-content" id="wrap-content">

        <input type="text" on-keyup='_onKeyPress' placeholder="Digite sua busca">

        <ul class="drop-content-list">
          <template is="dom-repeat" items="{{options}}" >
            <li class="js-drop-content-item" on-click='_onItemSelected' data-value='{{item.id}}' >{{item.name}}</li>
          </template>
        </ul>
      </div>
    </div>    
  </template>

  <script>
    Polymer({
      is: 'br-selectbox',
      properties: {

        originalOptions: {
          type: Array,
          readyOnly: true
        },
        
        options: {
          type: Array,
          value: []
        },

        multiselect: {
          type: Boolean,
          value: false
        }
      },


      /* -- Lifecycle ------------------------------------------------- */

      ready: function(){

        //_init();

        this._setOriginalOptions(this.options);
      },

      /* -- Private Methods ------------------------------------------- */

      // _init: function() {
      //    if(this.multiselect) 
      // },

      _setOriginalOptions: function(options){
        this.originalOptions = options;
      },

      _closeSelect: function(){
        document.getElementById('wrap-content').classList.remove('open');
      },

      _toggleSelect: function(){
        document.getElementById('wrap-content').classList.toggle('open')
      },

      _onKeyPress: function(e) {     

        var filtered = this.options.filter(function(value, index, array){          
          return array[index].name.indexOf(e.target.value) !== -1;
        });
        this.options = filtered;                

        if(!e.target.value.trim())         
         this.options = this.originalOptions;
       
     },

    _onItemSelected: function(e){

      if(this.multiselect === false) {
        
        var items = document.getElementsByClassName('js-drop-content-item');

        for (var i = 0; i < items.length; i++)
          items[i].classList.remove('is_selected');      
      }

      e.target.classList.toggle('is_selected');

    }



     /* -- Public Methods -------------------------------------------- */


   });
  </script>
</dom-module>